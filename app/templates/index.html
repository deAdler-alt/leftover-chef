{% extends "base.html" %}
{% block content %}

<section class="card">
  <h2>Your ingredients</h2>
  <form method="post" action="/plan" class="stack">
    <div id="rows" class="stack">
      {% if ingredients_list and ingredients_list|length > 0 %}
        {% for name, exp in ingredients_list %}
          {% set name_val = name %}
          {% set expiry_val = exp %}
          {% include "partials/ingredient_row.html" %}
        {% endfor %}
      {% else %}
        {% set name_val = '' %}
        {% set expiry_val = '' %}
        {% include "partials/ingredient_row.html" %}
      {% endif %}
    </div>
    <div class="row actions">
      <button type="button" hx-post="/row" hx-target="#rows" hx-swap="beforeend">Add row</button>
      <button type="submit">Generate suggestions</button>
    </div>
  </form>
</section>

{% if use_first and use_first|length > 0 %}
<section class="card">
  <h3>Use first</h3>
  <ul>
    {% for it in use_first %}
      <li><strong>{{ it.name }}</strong>{% if it.expiry %} — use by: {{ it.expiry }}{% endif %}</li>
    {% endfor %}
  </ul>
</section>
{% endif %}

<section class="card">
  <h2>Suggestions</h2>
  {% if suggestions and suggestions|length > 0 %}
    <ol>
      {% for s in suggestions %}
        <li>{{ s }}</li>
      {% endfor %}
    </ol>
  {% else %}
    <p>No suggestions yet. Add ingredients and submit.</p>
  {% endif %}
</section>

<section class="card">
  <h2>Top recipes</h2>
  {% if recipes and recipes|length > 0 %}
    <ol>
      {% for rec in recipes %}
        <li>
          <strong>{{ rec.title }}</strong><br>
          <small class="meta">match score: {{ '%.2f'|format(rec.score) }}{% if rec.minutes %} • {{ rec.minutes }} min{% endif %}</small>
          <p>{{ rec.directions }}</p>
          <a class="btn" href="/recipe/{{ rec.id }}">View details</a>
        </li>
      {% endfor %}
    </ol>
  {% else %}
    <p>No matching recipes yet.</p>
  {% endif %}
</section>

<section class="card">
  <h2>AI suggestions (optional)</h2>
  <div class="row">
    <button type="button" id="ai-btn" onclick="aiSuggest()">Try AI</button>
  </div>
  <pre id="ai-out"></pre>
</section>

{% endblock %}
